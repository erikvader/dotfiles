#!/bin/bash

# Squashes the current feature branch into a single commit

set -e

if [[ $# -ne 1 ]]; then
    echo 'Needs a branch revision to squash against, like origin/develop' >&2
    exit 1
fi

upstream=$1
head=$(git rev-parse HEAD)
base=$(git merge-base HEAD "$upstream")

git reset --soft "$base"

echo
echo "Commit the result with 'git commit'"
echo "or run 'git reset --soft $head' to undo"
